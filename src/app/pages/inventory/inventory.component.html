<div class="inventory-container">
  <!-- Back Button -->
  <div class="back-navigation">
    <button class="btn btn-back" (click)="goToDashboard()">
      <i class="fas fa-arrow-left"></i>
      Back to Dashboard
    </button>
  </div>

  <div class="inventory-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-boxes"></i>
        Inventory Management
      </h1>
      <div class="header-actions">
        <button 
          class="btn btn-primary" 
          (click)="openAddProductModal()"
          *ngIf="canManageInventory()">
          <i class="fas fa-plus"></i>
          Add Product
        </button>
        <button 
          class="btn btn-secondary" 
          (click)="openStockAdjustmentModal()"
          *ngIf="canManageInventory()">
          <i class="fas fa-edit"></i>
          Stock Adjustment
        </button>
        <button class="btn btn-outline" (click)="exportInventory()">
          <i class="fas fa-download"></i>
          Export
        </button>
        <button class="btn btn-outline" (click)="openNotificationSettings()">
          <i class="fas fa-bell-slash"></i>
          Notification Settings
        </button>
        <button class="btn btn-danger" (click)="clearStockNotifications()">
          <i class="fas fa-trash"></i>
          Clear Stock Notifications
        </button>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="inventory-filters">
    <div class="filters-row">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input 
          type="text" 
          placeholder="Search products..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()">
      </div>
      <div class="filter-group">
        <select [(ngModel)]="selectedCategory" (change)="onFilterChange()">
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
        <select [(ngModel)]="selectedWarehouse" (change)="onFilterChange()">
          <option value="">All Warehouses</option>
          <option *ngFor="let warehouse of warehouses" [value]="warehouse.id">
            {{ warehouse.name }}
          </option>
        </select>
        <select [(ngModel)]="stockFilter" (change)="onFilterChange()">
          <option value="all">All Stock</option>
          <option value="low">Low Stock</option>
          <option value="out">Out of Stock</option>
          <option value="available">Available</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Inventory Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-boxes"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalProducts }}</h3>
        <p>Total Products</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ lowStockCount }}</h3>
        <p>Low Stock Items</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-times-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ outOfStockCount }}</h3>
        <p>Out of Stock</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalValue | currency }}</h3>
        <p>Total Value</p>
      </div>
    </div>
  </div>

  <!-- Inventory Table -->
  <div class="inventory-table-container">
    <div class="table-header">
      <h3>Inventory Items</h3>
      <div class="table-actions">
        <button class="btn btn-sm btn-outline" (click)="toggleViewMode()">
          <i class="fas" [class.fa-th]="viewMode === 'grid'" [class.fa-list]="viewMode === 'list'"></i>
          {{ viewMode === 'grid' ? 'List View' : 'Grid View' }}
        </button>
      </div>
    </div>

    <!-- List View -->
    <div class="table-responsive" *ngIf="viewMode === 'list'">
      <table class="inventory-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>SKU</th>
            <th>Category</th>
            <th>Warehouse</th>
            <th>LOT</th>
            <th>Expire Date</th>
            <th>Stock</th>
            <th>Unit Price</th>
            <th>Total Value</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredInventory" class="inventory-row">
            <td class="product-cell">
              <div class="product-info">
                <img [src]="item.product.imageUrl || 'assets/images/default-product.svg'" 
                     [alt]="item.product.name" 
                     class="product-image">
                <div class="product-details">
                  <h4>{{ item.product.name }}</h4>
                  <p>{{ item.product.brand }}</p>
                </div>
              </div>
            </td>
            <td>{{ item.product.sku }}</td>
            <td>{{ item.product.category }}</td>
            <td>
              <button class="warehouse-link" (click)="goToWarehouse(item.warehouseId)" 
                      [title]="'View ' + getWarehouseName(item.warehouseId) + ' details'">
                <i class="fas fa-warehouse"></i>
                {{ getWarehouseName(item.warehouseId) }}
              </button>
            </td>
            <td>{{ item.batchNumber || 'N/A' }}</td>
            <td [class.expired]="isExpired(item.expiryDate)">{{ formatDateForDisplay(item.expiryDate) }}</td>
            <td class="stock-cell">
              <div class="stock-info">
                <span class="stock-quantity" 
                      [class.low-stock]="item.quantity <= item.reorderPoint"
                      [class.out-of-stock]="item.quantity === 0">
                  {{ item.quantity }}
                </span>
                <small class="stock-details">
                  Min: {{ item.minStockLevel }} | Max: {{ item.maxStockLevel }}
                </small>
              </div>
            </td>
            <td>{{ item.product.unitPrice | currency }}</td>
            <td>{{ (item.quantity * item.product.unitPrice) | currency }}</td>
            <td>
              <span class="status-badge" 
                    [class.low-stock]="item.quantity <= item.reorderPoint && item.quantity > 0"
                    [class.out-of-stock]="item.quantity === 0"
                    [class.available]="item.quantity > item.reorderPoint">
                {{ getStockStatus(item) }}
              </span>
            </td>
            <td class="actions-cell">
              <div class="action-buttons">
                <button class="btn btn-sm btn-outline" 
                        (click)="viewProduct(item)"
                        title="View Details">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-sm btn-info" 
                        (click)="viewOrdersForProduct(item)"
                        title="View Orders">
                  <i class="fas fa-shopping-cart"></i>
                </button>
                <button class="btn btn-sm btn-primary" 
                        (click)="editProduct(item)"
                        *ngIf="canManageInventory()"
                        title="Edit">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-warning" 
                        (click)="adjustStock(item)"
                        *ngIf="canManageInventory()"
                        title="Adjust Stock">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" 
                        (click)="deleteProduct(item)"
                        *ngIf="canManageInventory()"
                        title="Delete">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Grid View -->
    <div class="inventory-grid" *ngIf="viewMode === 'grid'">
      <div class="inventory-card" *ngFor="let item of filteredInventory">
        <div class="card-header">
          <img [src]="item.product.imageUrl || 'assets/images/default-product.svg'" 
               [alt]="item.product.name" 
               class="product-image">
          <div class="product-status">
            <span class="status-badge" 
                  [class.low-stock]="item.quantity <= item.reorderPoint && item.quantity > 0"
                  [class.out-of-stock]="item.quantity === 0"
                  [class.available]="item.quantity > item.reorderPoint">
              {{ getStockStatus(item) }}
            </span>
          </div>
        </div>
        <div class="card-body">
          <h4 class="product-name">{{ item.product.name }}</h4>
          <p class="product-brand">{{ item.product.brand }}</p>
          <p class="product-sku">SKU: {{ item.product.sku }}</p>
          <div class="warehouse-info">
            <button class="warehouse-link" (click)="goToWarehouse(item.warehouseId)" 
                    [title]="'View ' + getWarehouseName(item.warehouseId) + ' details'">
              <i class="fas fa-warehouse"></i>
              {{ getWarehouseName(item.warehouseId) }}
            </button>
            <span class="location" *ngIf="item.location">
              <i class="fas fa-map-marker-alt"></i>
              {{ item.location }}
            </span>
          </div>
          <div class="lot-expiry-info" *ngIf="item.batchNumber || item.expiryDate">
            <div class="lot-info" *ngIf="item.batchNumber">
              <i class="fas fa-barcode"></i>
              <span>LOT: {{ item.batchNumber }}</span>
            </div>
            <div class="expiry-info" *ngIf="item.expiryDate" [class.expired]="isExpired(item.expiryDate)">
              <i class="fas fa-calendar-alt"></i>
              <span>Expires: {{ formatDateForDisplay(item.expiryDate) }}</span>
            </div>
          </div>
          <div class="stock-info">
            <div class="stock-quantity" 
                 [class.low-stock]="item.quantity <= item.reorderPoint"
                 [class.out-of-stock]="item.quantity === 0">
              {{ item.quantity }} {{ item.product.unit }}
            </div>
            <div class="stock-details">
              Min: {{ item.minStockLevel }} | Max: {{ item.maxStockLevel }}
            </div>
          </div>
          <div class="price-info">
            <span class="unit-price">{{ item.product.unitPrice | currency }}</span>
            <span class="total-value">{{ (item.quantity * item.product.unitPrice) | currency }}</span>
          </div>
        </div>
        <div class="card-footer">
          <div class="action-buttons">
            <button class="btn btn-sm btn-outline" (click)="viewProduct(item)">
              <i class="fas fa-eye"></i>
            </button>
            <button class="btn btn-sm btn-info" (click)="viewOrdersForProduct(item)">
              <i class="fas fa-shopping-cart"></i>
            </button>
            <button class="btn btn-sm btn-primary" 
                    (click)="editProduct(item)"
                    *ngIf="canManageInventory()">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-warning" 
                    (click)="adjustStock(item)"
                    *ngIf="canManageInventory()">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger" 
                    (click)="deleteProduct(item)"
                    *ngIf="canManageInventory()">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <app-pagination
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        [pageSize]="pageSize"
        (pageChange)="onPageChange($event)">
      </app-pagination>
    </div>
  </div>
</div>

<!-- Add/Edit Product Modal -->
<div class="modal" [class.active]="showProductModal" *ngIf="showProductModal">
  <div class="modal-backdrop" (click)="closeProductModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h3>
      <button class="btn btn-close" (click)="closeProductModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
        <div class="form-row">
          <div class="form-group">
            <label for="name">Product Name *</label>
            <input type="text" id="name" formControlName="name" required>
          </div>
          <div class="form-group">
            <label for="sku">SKU *</label>
            <input type="text" id="sku" formControlName="sku" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="category">Category *</label>
            <div class="category-input-group">
              <select id="category" formControlName="category" required>
                <option value="">Select Category</option>
                <option *ngFor="let category of categories" [value]="category.name">
                  {{ category.name }}
                </option>
              </select>
              <button type="button" class="btn btn-outline btn-sm" (click)="openCategoryModal()" title="Manage Categories">
                <i class="fas fa-cog"></i>
              </button>
            </div>
          </div>
          <div class="form-group">
            <label for="brand">Brand *</label>
            <input type="text" id="brand" formControlName="brand" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="unitPrice">Unit Price *</label>
            <input type="number" id="unitPrice" formControlName="unitPrice" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="costPrice">Cost Price *</label>
            <input type="number" id="costPrice" formControlName="costPrice" step="0.01" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="unit">Unit *</label>
            <select id="unit" formControlName="unit" required>
              <option value="">Select Unit</option>
              <option value="pcs">Pieces</option>
              <option value="kg">Kilograms</option>
              <option value="g">Grams</option>
              <option value="l">Liters</option>
              <option value="ml">Milliliters</option>
              <option value="m">Meters</option>
              <option value="cm">Centimeters</option>
            </select>
          </div>
          <div class="form-group">
            <label for="weight">Weight (kg)</label>
            <input type="number" id="weight" formControlName="weight" step="0.01">
          </div>
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" formControlName="description" rows="3"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="barcode">Barcode</label>
            <input type="text" id="barcode" formControlName="barcode">
          </div>
          <div class="form-group">
            <label for="batchNumber">LOT Number</label>
            <input type="text" id="batchNumber" formControlName="batchNumber" placeholder="Enter LOT number">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="expiryDate">Expire Date</label>
            <input type="date" id="expiryDate" formControlName="expiryDate">
          </div>
          <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input type="url" id="imageUrl" formControlName="imageUrl" placeholder="Leave empty for default icon">
          </div>
        </div>
        <div class="form-group">
          <label for="warehouseId">Warehouse *</label>
          <select id="warehouseId" formControlName="warehouseId" required>
            <option value="">Select Warehouse</option>
            <option *ngFor="let warehouse of warehouses" [value]="warehouse.id">
              {{ warehouse.name }}
            </option>
          </select>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeProductModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveProduct()" [disabled]="productForm.invalid">
        {{ editingProduct ? 'Update' : 'Create' }}
      </button>
    </div>
  </div>
</div>

<!-- Stock Adjustment Modal -->
<div class="modal" [class.active]="showStockModal" *ngIf="showStockModal">
  <div class="modal-backdrop" (click)="closeStockModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>Stock Adjustment</h3>
      <button class="btn btn-close" (click)="closeStockModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="stockForm" (ngSubmit)="saveStockAdjustment()">
        <div class="form-group">
          <label>Product</label>
        <div class="product-info" *ngIf="selectedItem">
          <img [src]="selectedItem.product.imageUrl || 'assets/images/default-product.svg'" 
               [alt]="selectedItem.product.name" 
               class="product-image">
          <div class="product-details">
            <h4>{{ selectedItem.product.name }}</h4>
            <p>Current Stock: {{ selectedItem.quantity }} {{ selectedItem.product.unit }}</p>
          </div>
        </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="movementType">Movement Type *</label>
            <select id="movementType" formControlName="movementType" required>
              <option value="">Select Type</option>
              <option value="in">Stock In</option>
              <option value="out">Stock Out</option>
              <option value="adjustment">Adjustment</option>
              <option value="transfer">Transfer</option>
            </select>
          </div>
          <div class="form-group">
            <label for="quantity">Quantity *</label>
            <input type="number" id="quantity" formControlName="quantity" required>
          </div>
        </div>
        <div class="form-group">
          <label for="reason">Reason *</label>
          <input type="text" id="reason" formControlName="reason" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="batchNumber">LOT Number</label>
            <input type="text" id="batchNumber" formControlName="batchNumber" placeholder="Enter LOT number">
          </div>
          <div class="form-group">
            <label for="expiryDate">Expire Date</label>
            <input type="date" id="expiryDate" formControlName="expiryDate">
          </div>
        </div>
        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" formControlName="notes" rows="3"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeStockModal()">Cancel</button>
      <button class="btn btn-primary" (click)="saveStockAdjustment()" [disabled]="stockForm.invalid">
        Save Adjustment
      </button>
    </div>
  </div>
</div>

<!-- Category Management Modal -->
<div class="modal" [class.active]="showCategoryModal" *ngIf="showCategoryModal">
  <div class="modal-backdrop" (click)="closeCategoryModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>
        <i class="fas fa-tags"></i>
        Manage Categories
      </h3>
      <button class="btn btn-close" (click)="closeCategoryModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <!-- Add New Category Form -->
      <div class="add-category-section">
        <h4>Add New Category</h4>
        <form [formGroup]="categoryForm" (ngSubmit)="addCategory()">
          <div class="form-row">
            <div class="form-group">
              <label for="categoryName">Category Name *</label>
              <input 
                type="text" 
                id="categoryName" 
                formControlName="name" 
                placeholder="Enter category name"
                required>
            </div>
            <div class="form-group">
              <label for="categoryDescription">Description</label>
              <input 
                type="text" 
                id="categoryDescription" 
                formControlName="description" 
                placeholder="Enter description (optional)">
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="categoryForm.invalid">
              <i class="fas fa-plus"></i>
              Add Category
            </button>
          </div>
        </form>
      </div>

      <!-- Categories List -->
      <div class="categories-list-section">
        <h4>Existing Categories</h4>
        <div class="categories-list" *ngIf="categories.length > 0">
          <div class="category-item" *ngFor="let category of categories">
            <div class="category-info">
              <h5>{{ category.name }}</h5>
              <p *ngIf="category.description">{{ category.description }}</p>
              <small class="category-meta">
                Created: {{ category.createdAt | date:'short' }}
              </small>
            </div>
            <div class="category-actions">
              <button class="btn btn-sm btn-outline" (click)="editCategory(category)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteCategory(category)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="no-categories" *ngIf="categories.length === 0">
          <i class="fas fa-tags"></i>
          <p>No categories found. Add your first category above.</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCategoryModal()">
        <i class="fas fa-times"></i>
        Close
      </button>
    </div>
  </div>
</div>

<!-- Product Detail Modal -->
<div class="modal" [class.active]="showProductDetailModal" *ngIf="showProductDetailModal">
  <div class="modal-backdrop" (click)="closeProductDetailModal()"></div>
  <div class="modal-content product-detail-modal">
    <div class="modal-header">
      <h3>
        <i class="fas fa-box"></i>
        Product Details
      </h3>
      <button class="btn btn-close" (click)="closeProductDetailModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" *ngIf="selectedItem">
      <!-- Product Header -->
      <div class="product-header">
        <div class="product-image-section">
          <img [src]="selectedItem.product.imageUrl || 'assets/images/default-product.svg'" 
               [alt]="selectedItem.product.name" 
               class="product-main-image">
        </div>
        <div class="product-basic-info">
          <h2>{{ selectedItem.product.name }}</h2>
          <p class="product-brand">{{ selectedItem.product.brand }}</p>
          <p class="product-sku">SKU: {{ selectedItem.product.sku }}</p>
          <div class="product-status">
            <span class="status-badge" 
                  [class.low-stock]="selectedItem.quantity <= selectedItem.reorderPoint && selectedItem.quantity > 0"
                  [class.out-of-stock]="selectedItem.quantity === 0"
                  [class.available]="selectedItem.quantity > selectedItem.reorderPoint">
              {{ getStockStatus(selectedItem) }}
            </span>
          </div>
        </div>
      </div>

      <!-- Product Details Grid -->
      <div class="product-details-grid">
        <div class="detail-section">
          <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Category:</span>
              <span class="value">{{ selectedItem.product.category }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Unit:</span>
              <span class="value">{{ selectedItem.product.unit }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Weight:</span>
              <span class="value">{{ selectedItem.product.weight || 'N/A' }} kg</span>
            </div>
            <div class="detail-row">
              <span class="label">Barcode:</span>
              <span class="value">{{ selectedItem.product.barcode || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4><i class="fas fa-dollar-sign"></i> Pricing</h4>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Unit Price:</span>
              <span class="value">{{ selectedItem.product.unitPrice | currency }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Cost Price:</span>
              <span class="value">{{ selectedItem.product.costPrice | currency }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Total Value:</span>
              <span class="value">{{ (selectedItem.quantity * selectedItem.product.unitPrice) | currency }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4><i class="fas fa-warehouse"></i> Inventory</h4>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">Current Stock:</span>
              <span class="value" [class.low-stock]="selectedItem.quantity <= selectedItem.reorderPoint"
                    [class.out-of-stock]="selectedItem.quantity === 0">
                {{ selectedItem.quantity }} {{ selectedItem.product.unit }}
              </span>
            </div>
            <div class="detail-row">
              <span class="label">Min Stock Level:</span>
              <span class="value">{{ selectedItem.minStockLevel }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Max Stock Level:</span>
              <span class="value">{{ selectedItem.maxStockLevel }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Reorder Point:</span>
              <span class="value">{{ selectedItem.reorderPoint }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Location:</span>
              <span class="value">{{ selectedItem.location || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4><i class="fas fa-barcode"></i> LOT & Expiry</h4>
          <div class="detail-content">
            <div class="detail-row">
              <span class="label">LOT Number:</span>
              <span class="value">{{ selectedItem.batchNumber || 'N/A' }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Expiry Date:</span>
              <span class="value" [class.expired]="isExpired(selectedItem.expiryDate)">
                {{ formatDateForDisplay(selectedItem.expiryDate) }}
              </span>
            </div>
            <div class="detail-row" *ngIf="selectedItem.supplierName">
              <span class="label">Supplier:</span>
              <span class="value">{{ selectedItem.supplierName }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Description -->
      <div class="description-section" *ngIf="selectedItem.product.description">
        <h4><i class="fas fa-align-left"></i> Description</h4>
        <p>{{ selectedItem.product.description }}</p>
      </div>

      <!-- Notes -->
      <div class="notes-section" *ngIf="selectedItem.notes">
        <h4><i class="fas fa-sticky-note"></i> Notes</h4>
        <p>{{ selectedItem.notes }}</p>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeProductDetailModal()">
        <i class="fas fa-times"></i>
        Close
      </button>
      <button class="btn btn-primary" (click)="editProduct(selectedItem!)" *ngIf="canManageInventory()">
        <i class="fas fa-edit"></i>
        Edit Product
      </button>
    </div>
  </div>
</div>

<!-- View Order Modal -->
<div class="modal" [class.active]="showOrderModal" *ngIf="showOrderModal">
  <div class="modal-backdrop" (click)="closeOrderModal()"></div>
  <div class="modal-content order-modal">
    <div class="modal-header">
      <h3>
        <i class="fas fa-shopping-cart"></i>
        Order Details
      </h3>
      <button class="btn btn-close" (click)="closeOrderModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" *ngIf="selectedOrder">
      <!-- Order Header Info -->
      <div class="order-header">
        <div class="order-number">
          <h4>Order #{{ selectedOrder.orderNumber }}</h4>
          <span class="order-status" [class]="'status-' + selectedOrder.status">
            {{ selectedOrder.status | titlecase }}
          </span>
        </div>
        <div class="order-dates">
          <p><strong>Created:</strong> {{ selectedOrder.createdAt | date:'medium' }}</p>
          <p *ngIf="selectedOrder.expectedDeliveryDate">
            <strong>Expected Delivery:</strong> {{ selectedOrder.expectedDeliveryDate | date:'medium' }}
          </p>
          <p *ngIf="selectedOrder.shippedAt">
            <strong>Shipped:</strong> {{ selectedOrder.shippedAt | date:'medium' }}
          </p>
          <p *ngIf="selectedOrder.deliveredAt">
            <strong>Delivered:</strong> {{ selectedOrder.deliveredAt | date:'medium' }}
          </p>
        </div>
      </div>

      <!-- Customer Information -->
      <div class="customer-section">
        <h4><i class="fas fa-user"></i> Customer Information</h4>
        <div class="customer-info">
          <div class="customer-details">
            <p><strong>Name:</strong> {{ selectedOrder.customerName }}</p>
            <p><strong>Email:</strong> {{ selectedOrder.customerEmail }}</p>
            <p><strong>Phone:</strong> {{ selectedOrder.customerPhone }}</p>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="address-section">
        <h4><i class="fas fa-shipping-fast"></i> Shipping Address</h4>
        <div class="address-info">
          <p>{{ selectedOrder.shippingAddress.street }}</p>
          <p>{{ selectedOrder.shippingAddress.city }}, {{ selectedOrder.shippingAddress.state }} {{ selectedOrder.shippingAddress.zipCode }}</p>
          <p>{{ selectedOrder.shippingAddress.country }}</p>
        </div>
      </div>

      <!-- Order Items -->
      <div class="order-items-section">
        <h4><i class="fas fa-boxes"></i> Order Items</h4>
        <div class="order-items-table">
          <table class="items-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>SKU</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of selectedOrder.items">
                <td class="product-cell">
                  <div class="product-info">
                    <img [src]="item.product.imageUrl || 'assets/images/default-product.svg'" 
                         [alt]="item.product.name" 
                         class="product-image">
                    <div class="product-details">
                      <h5>{{ item.product.name }}</h5>
                      <p>{{ item.product.brand }}</p>
                    </div>
                  </div>
                </td>
                <td>{{ item.product.sku }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unitPrice | currency }}</td>
                <td>{{ item.totalPrice | currency }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <div class="summary-row">
          <span>Subtotal:</span>
          <span>{{ selectedOrder.subtotal | currency }}</span>
        </div>
        <div class="summary-row" *ngIf="selectedOrder.discountAmount > 0">
          <span>Discount:</span>
          <span>-{{ selectedOrder.discountAmount | currency }}</span>
        </div>
        <div class="summary-row">
          <span>Tax:</span>
          <span>{{ selectedOrder.taxAmount | currency }}</span>
        </div>
        <div class="summary-row">
          <span>Shipping:</span>
          <span>{{ selectedOrder.shippingAmount | currency }}</span>
        </div>
        <div class="summary-row total-row">
          <span><strong>Total:</strong></span>
          <span><strong>{{ selectedOrder.totalAmount | currency }}</strong></span>
        </div>
      </div>

      <!-- Additional Info -->
      <div class="additional-info" *ngIf="selectedOrder.notes || selectedOrder.trackingNumber">
        <h4><i class="fas fa-info-circle"></i> Additional Information</h4>
        <div class="info-content">
          <p *ngIf="selectedOrder.trackingNumber">
            <strong>Tracking Number:</strong> {{ selectedOrder.trackingNumber }}
          </p>
          <p *ngIf="selectedOrder.assignedToName">
            <strong>Assigned To:</strong> {{ selectedOrder.assignedToName }}
          </p>
          <p *ngIf="selectedOrder.notes">
            <strong>Notes:</strong> {{ selectedOrder.notes }}
          </p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeOrderModal()">
        <i class="fas fa-times"></i>
        Close
      </button>
    </div>
  </div>
</div>

<!-- Notification Settings Modal -->
<div class="modal" [class.active]="showNotificationSettingsModal" *ngIf="showNotificationSettingsModal">
  <div class="modal-backdrop" (click)="closeNotificationSettings()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>
        <i class="fas fa-bell-slash"></i>
        Notification Settings
      </h3>
      <button class="btn btn-close" (click)="closeNotificationSettings()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="notification-settings">
        <div class="setting-group">
          <h4>Notification Types</h4>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" [(ngModel)]="notificationSettings.showSuccessNotifications">
              <span class="slider"></span>
            </label>
            <div class="setting-info">
              <strong>Success Notifications</strong>
              <p>Show notifications for successful operations (e.g., "Item updated successfully")</p>
            </div>
          </div>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" [(ngModel)]="notificationSettings.showInfoNotifications">
              <span class="slider"></span>
            </label>
            <div class="setting-info">
              <strong>Info Notifications</strong>
              <p>Show informational messages (e.g., "No orders found")</p>
            </div>
          </div>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" [(ngModel)]="notificationSettings.showWarningNotifications">
              <span class="slider"></span>
            </label>
            <div class="setting-info">
              <strong>Warning Notifications</strong>
              <p>Show warnings (e.g., "Low stock alert", "Item deleted with stock")</p>
            </div>
          </div>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" [(ngModel)]="notificationSettings.showErrorNotifications">
              <span class="slider"></span>
            </label>
            <div class="setting-info">
              <strong>Error Notifications</strong>
              <p>Show error messages (e.g., "Failed to save item")</p>
            </div>
          </div>
          <div class="setting-item">
            <label class="switch">
              <input type="checkbox" [(ngModel)]="notificationSettings.showStockAdjustmentNotifications">
              <span class="slider"></span>
            </label>
            <div class="setting-info">
              <strong>Stock Adjustment Notifications</strong>
              <p>Show notifications for stock adjustments (e.g., "Stock in 50 units")</p>
            </div>
          </div>
        </div>
        
        <div class="setting-group">
          <h4>Throttling Settings</h4>
          <div class="setting-item">
            <label for="throttleDuration">Throttle Duration (seconds)</label>
            <input type="number" id="throttleDuration" [(ngModel)]="notificationSettings.throttleDuration" min="1" max="60">
            <p>Prevent duplicate notifications within this time period</p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeNotificationSettings()">Cancel</button>
      <button class="btn btn-primary" (click)="saveNotificationSettings()">Save Settings</button>
    </div>
  </div>
</div>
